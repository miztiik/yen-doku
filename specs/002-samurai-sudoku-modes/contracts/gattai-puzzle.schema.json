{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://yen-doku.github.io/schemas/gattai-puzzle.json",
  "title": "GattaiPuzzle",
  "description": "A Samurai Sudoku (multi-grid) puzzle with overlapping grids",
  "type": "object",
  "required": ["date", "mode", "difficulty", "clueCount", "version", "grids"],
  "properties": {
    "date": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Puzzle date in YYYY-MM-DD format"
    },
    "mode": {
      "type": "string",
      "enum": ["samurai", "twin-nw", "twin-ne", "twin-sw", "twin-se"],
      "description": "Gattai puzzle mode defining grid arrangement"
    },
    "difficulty": {
      "type": "string",
      "enum": ["easy", "medium", "hard", "extreme"],
      "description": "Puzzle difficulty level"
    },
    "clueCount": {
      "type": "integer",
      "minimum": 38,
      "maximum": 250,
      "description": "Total number of pre-filled clues across all grids"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Schema version for forward compatibility"
    },
    "grids": {
      "type": "object",
      "description": "Map of grid ID to SubGrid data",
      "additionalProperties": {
        "$ref": "#/definitions/SubGrid"
      },
      "minProperties": 2,
      "maxProperties": 5
    }
  },
  "definitions": {
    "SubGrid": {
      "type": "object",
      "required": ["grid", "solution"],
      "properties": {
        "grid": {
          "$ref": "#/definitions/Grid9x9",
          "description": "Puzzle grid with 0 for empty cells"
        },
        "solution": {
          "$ref": "#/definitions/Grid9x9Complete",
          "description": "Complete solution grid"
        }
      }
    },
    "Grid9x9": {
      "type": "array",
      "items": {
        "type": "array",
        "items": {
          "type": "integer",
          "minimum": 0,
          "maximum": 9
        },
        "minItems": 9,
        "maxItems": 9
      },
      "minItems": 9,
      "maxItems": 9,
      "description": "9x9 grid where 0 represents empty cells"
    },
    "Grid9x9Complete": {
      "type": "array",
      "items": {
        "type": "array",
        "items": {
          "type": "integer",
          "minimum": 1,
          "maximum": 9
        },
        "minItems": 9,
        "maxItems": 9
      },
      "minItems": 9,
      "maxItems": 9,
      "description": "Complete 9x9 grid with all cells filled (1-9)"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "mode": { "const": "samurai" } }
      },
      "then": {
        "properties": {
          "grids": {
            "required": ["center", "nw", "ne", "sw", "se"],
            "properties": {
              "center": { "$ref": "#/definitions/SubGrid" },
              "nw": { "$ref": "#/definitions/SubGrid" },
              "ne": { "$ref": "#/definitions/SubGrid" },
              "sw": { "$ref": "#/definitions/SubGrid" },
              "se": { "$ref": "#/definitions/SubGrid" }
            },
            "additionalProperties": false
          }
        }
      }
    },
    {
      "if": {
        "properties": { "mode": { "pattern": "^twin-" } }
      },
      "then": {
        "properties": {
          "grids": {
            "required": ["primary", "secondary"],
            "properties": {
              "primary": { "$ref": "#/definitions/SubGrid" },
              "secondary": { "$ref": "#/definitions/SubGrid" }
            },
            "additionalProperties": false
          }
        }
      }
    }
  ]
}
